# Fast R-CNN

	1) ë¯¸ë¦¬ í•™ìŠµëœ CNNì— ì „ì²´ ì´ë¯¸ì§€ë¥¼ í†µê³¼ì‹œì¼œ feature mapì„ ì¶”ì¶œ
	2) selective searchë¡œ ì°¾ì€ ê°ê°ì˜ roiì— ëŒ€í•´ roi poolingì„ ì§„í–‰ â†’ ê³ ì •ëœ í¬ê¸°ì˜ feature vectorë¥¼ ì–»ìŒ
	3) feature vectorëŠ” fully connected layerë¥¼ í†µê³¼í•œ ë’¤, 2ê°œì˜ ë¸Œëœì¹˜(softmax, bbox regressor)ë¡œ ë‚˜ë‰¨
	4-1) í•˜ë‚˜ì˜ ë¸Œëœì¹˜ëŠ” softmaxë¥¼ í†µê³¼í•´ í•´ë‹¹ roiê°€ ì–´ë–¤ ë¬¼ì²´ì¸ì§€ classification(SVMì€ ì‚¬ìš©ë˜ì§€ ì•ŠìŒ) â†’ softmax ë¶„ë¥˜ê¸°
	4-2) ë‹¤ë¥¸ ë¸Œëœì¹˜ë¥¼ bounding box regressionì„ í†µí•´ selective searchë¡œ ì°¾ì€ ë°•ìŠ¤ì˜ ìœ„ì¹˜ë¥¼ ì¡°ì • â†’ bbox regressor


### CNN
<img src="https://user-images.githubusercontent.com/33839093/109451994-1620e300-7a92-11eb-83f6-9bec6378d637.png" width="700">

- R-CNN : input image â†’ selective searchë¥¼ í†µí•´ 2ì²œê°œì˜ region proposal ë½‘ê¸° â†’ CNN(2ì²œë²ˆ ìˆ˜í–‰)

- Fast R-CNN : input image â†’ selective searchë¥¼ í†µí•´ 2ì²œê°œì˜ region proposal ë½‘ê¸° â†’ input imageì „ì²´ì— ëŒ€í•´ CNN(1ë²ˆ ìˆ˜í–‰) â†’ ë½‘ì•„ë†“ì€ roiì˜ì—­ì„ feature mapì— ì ìš©ì‹œí‚¤ê³ , roi poolingì„ í†µí•´ ì¼ì •í•œ í¬ê¸°ë¡œ ë§ì¶”ê¸° â†’ FCs â†’ softmax & bbox regressor


### ROI pooling
> - FCs(fully-connected layer)ì— ë„£ê¸° ìœ„í•´ì„œëŠ” ê°™ì€ í¬ê¸°ì˜(resolution) feature mapì´ í•„ìš”í•¨
> - selective searchë¥¼ í†µí•´ ì–»ì€ roiëŠ” í¬ê¸°ê°€ ë‹¤ë¥´ê¸° ë•Œë¬¸ì— roi poolingì„ ìˆ˜í–‰í•¨
> - í¬ê¸°ê°€ ë‹¤ë¥¸ feature mapì˜ strideë¥¼ ë‹¤ë¥´ê²Œ, max poolingì„ ì ìš©í•´ ì¼ì •í•œ í¬ê¸°ë¡œ ë§Œë“¦
> <img src="https://user-images.githubusercontent.com/33839093/109452200-90e9fe00-7a92-11eb-9b0b-e97dd0df9125.jpg" width="600">

ğŸ‘‰ 8x8í¬ê¸°ì˜ feature mapì´ ë“¤ì–´ì™€ selective searchë¡œ ë½‘ì€ roiì˜ í¬ê¸°ê°€ 7x5ì¼ ë•Œ, output sizeë¥¼ 2x2ë¡œ ê³ ì •ì‹œí‚¤ê³  ì‹¶ìœ¼ë©´ stride=(3, 2)ë¡œ ì„¤ì •í•˜ë©´ ë¨


### Classification & Bounding Box regression

- roi poolingìœ¼ë¡œ ì–»ì€ ê³ ì •ëœ í¬ê¸°ì˜ feature vector(fixed length feature vector) regression 2ê°€ì§€ì˜ ê°ˆë˜ë¡œ ë»—ì–´ë‚˜ê°
- classificationê³¼ bounding box regressionì„ ë™ì‹œì— í•™ìŠµí•  ìˆ˜ ìˆë„ë¡ **multi-task loss** ì‚¬ìš©
<img src="https://user-images.githubusercontent.com/33839093/109453432-677ea180-7a95-11eb-9395-039b84d7b0a0.png" width="700">

> - pëŠ” softmaxë¥¼ í†µí•´ ì–»ì€ (k+1)ê°œ (kê°œì˜ ë¬¼ì²´+ë°°ê²½)ì˜ í™•ë¥ ê°’
> - uëŠ” í•´ë‹¹ roiì˜ ground truth ë¼ë²¨ ê°’

- classificationì—ëŠ” log lossë¥¼, bbox regressionì—ëŠ” smooth L1 lossë¥¼ ì‚¬ìš©í•¨
<img src="https://user-images.githubusercontent.com/33839093/109453539-b1678780-7a95-11eb-9662-90e5049b331e.JPG" width="350">

> - classificationì—ëŠ” (-log)í•¨ìˆ˜ë¥¼ ë§ì´ ì‚¬ìš©í•¨
> - í™•ë¥ ì´ ë†’ì„ìˆ˜ë¡ ì •ë³´ëŸ‰ì€ ë‚®ê³ , í™•ë¥ ì´ ë‚®ì„ìˆ˜ë¡ ì •ë³´ëŸ‰ì€ ë†’ë‹¤(ì •ë³´ëŸ‰=degree of surprise)

<img src="https://user-images.githubusercontent.com/33839093/109453603-dcea7200-7a95-11eb-844e-d5d0f15a610a.JPG" width="450">

> - íŒŒë€ìƒ‰ì€ |x| <1 ì¸ ê²½ìš°, ë¹¨ê°„ìƒ‰ì€ |x|-0.5ì¸ ê²½ìš°
> - smooth L1 lossí•¨ìˆ˜ëŠ” L2 lossí•¨ìˆ˜ì— ë¹„í•´ outlierì— robust(ëœ ì˜ˆë¯¼)í•¨ â†’ L2 lossë¥¼ ì‚¬ìš©í•˜ë©´ gradient explodingì„ ë°©ì§€í•˜ê¸° ìœ„í•´ learning rateë¥¼ ì˜ íŠœë‹í•´ì•¼í•¨
> - í•˜ì´í¼ íŒŒë¼ë¯¸í„°ì¸ ëŒë‹¤ì˜ ê°’ì„ 1ë¡œ ì„¤ì •í•´ 2ê°€ì§€ lossì˜ ê· í˜•ì„ ì¡°ì •í•¨ â†’ ground truthì¸ uê°’ì´ 0ì´ë©´ 0ê°’ì„ ê°€ì§€ê³ , ë‚˜ë¨¸ì§€ ê²½ìš°ì—ëŠ” 1ê°’ì„ ê°€ì§


### Contribution
- R-CNN, SPPnetë³´ë‹¤ ë›°ì–´ë‚œ ì„±ëŠ¥
- Single Stage Training
	 â†’ Single stage detectorëŠ” ì•„ë‹ˆê³ , 2-stage detector : selective searchë¡œ region proposalì„ ìˆ˜í–‰í•œ í›„, classification & bbox regressionì„ ìˆ˜í–‰í•˜ê¸° ë•Œë¬¸
- Backpropagation ê°€ëŠ¥
- ì €ì¥ê³µê°„ í•„ìš”X

### í•œê³„ì 
Region proposalì—ì„œ selective searchë¥¼ ì‚¬ìš©í•˜ê¸° ë•Œë¬¸ì— ë„ˆë¬´ ì˜¤ë˜ ê±¸ë¦¼

### References
- https://yeomko.tistory.com/15?category=888201
- https://yamalab.tistory.com/113
- https://nuggy875.tistory.com/33?category=860935
- https://www.youtube.com/watch?v=Dc0PQlNQhGY
